import pandas as pd

csv_input_path = "./class_counts/all_class_counts.csv"

# Read the CSV data
data = pd.read_csv(csv_input_path)

# Extract the filename from the input path
filename = data["filename"][0]

# Convert data types to numeric
data.iloc[:, 2:] = data.iloc[:, 2:].apply(pd.to_numeric, errors='coerce')

# Calculate row sums
row_sums = data.iloc[:, 2:].sum(axis=1)

# Convert counts to percentages
with warnings.catch_warnings():
  warnings.simplefilter(action='ignore', category=DeprecationWarning) # DeprecationWarning: In a future version, `df.iloc[:, i] = newvals` will attempt to set the values inplace instead of always setting a new array. 
  warnings.simplefilter(action='ignore', category=FutureWarning) # To retain the old behavior, use either `df[df.columns[i]] = newvals` or, if columns are non-unique, `df.isetitem(i, newvals)`
  data.iloc[:, 2:] = data.iloc[:, 2:].div(row_sums, axis=0) * 100

# Add filename column to output
data.insert(0, "filename", data.pop("filename"))

# Save the result as a new CSV
data.to_csv(csv_input_path.replace(".csv", "_percentages.csv"), index=False)
